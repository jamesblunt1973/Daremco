function setupMenu(){var t=$("header"),e=t.outerHeight(),r=$(".scroll-top"),s=$(document);r.click(function(){$("html, body").stop().animate({scrollTop:0},500,"swing")});var u=0,o=5,n="",f="up",i=!1}function setupMobileMenu(){var n=$(".hamburger"),t=$("body"),i=$(".menu ul");n.click(function(){n.toggleClass("open");i.toggleClass("open close").fadeToggle();n.hasClass("open")?t.css("overflow","hidden"):t.css("overflow","")})}function showPanel(n,t,i,r){function e(){r&&r();u.children().slideUp("fast",function(){u.fadeOut(function(){f.css("overflow","");o.removeClass("blur");u.remove()})})}function s(n,t){var i=u.find(".close");n?i.click(e):i.unbind("click");t?u.click(e):u.unbind("click")}function h(n){u.html("").append(n)}var u=$("<div />").addClass("layer").hide(),f,o;h(n);s(t,i);f=$("body");f.append(u);f.css("overflow","hidden");o=f.children("#container").addClass("blur");u.children().hide();u.fadeIn("fast",function(){u.children().slideDown("fast")});this.close=e;this.setClosable=s;this.setContent=h}function createPanel(n,t,i,r,u){var e=$("<div />").addClass("panel"),f,o,s;return u&&e.css("max-width",u),f=$("<div />").addClass("panel-header"),r&&f.append($("<span />").addClass(r)),i&&f.append(i),t&&(o=$("<div />").addClass("close"),o.attr({title:"بستن"}),o.append($("<span />").addClass("dkb-window-close")),f.append(o)),e.append(f),s=$("<div />").addClass("panel-content"),s.css({"max-height":$(window).outerHeight()-70,overflow:"auto"}),s.append(n),e.append(s),e}function setupLinkPanel(){$("a.panel").on("click",function(n){var t;if(n.preventDefault(),t=this,t.href!=="#"&&t.href!==""&&t.href!==window.location.href)var i=new showPanel(getLoading(),!1,!1),r=t.href,u=$.get(r).done(function(n){var e=u.getResponseHeader("content-type")||"",r,f;switch(e){case"image/png":case"image/jpg":case"image/jpeg":r=$("<img />").attr({src:t.href,"class":"center"}).hide();r.on("load",function(){var n=r.width(),t=r.height();r.css({width:1,height:1});r.show();r.animate({width:n,height:t},300,"swing")});i.setClosable(!1,!0);i.setContent(r);break;default:f=createPanel(n,!0,t.innerHTML,"","80%");i.setContent(f);i.setClosable(!0,!1)}}).fail(function(n,t,r){i.setContent(ajaxError(n,t,r));i.setClosable(!0,!1)})})}function getLoading(){return"<div class='lds-ellipsis'><div><\/div><div><\/div><div><\/div><div><\/div><\/div>"}function ajaxError(n,t,i){var f=$("<span />").addClass("dkb-triangle-danger"),u=$("<div />").addClass("error-panel"),r;return u.append(f),u.append($("<h1 />").text(i)),u.append($("<h2 />").text(t+" "+n.status)),r="",n.responseJSON?(n.responseJSON.Message&&(r+=n.responseJSON.Message+"<br />"),n.responseJSON.ExceptionMessage&&(r+=n.responseJSON.ExceptionMessage+"<br />"),n.responseJSON.title&&(r+=n.responseJSON.title)):r=n.responseText,u.append($("<p />").html(r)),createPanel(u,!0,"Server Communication Error","dkb-triangle-danger","80%")}function modifyQueryString(n,t){var u=window.location.search,i=[],r;return u&&(i=u.substr(1).split("&")),r=i.findIndex(function(n){var i=n.split("=");return i[0]===t}),n?r>-1?i[r]=t+"="+n:i.push(t+"="+n):r>-1&&i.splice(r),"?"+i.join("&")}function formatCurrency(n){var r=Math.abs(n),i=$("<span />").text(r),t;return i.formatCurrency({roundToDecimalPlace:0}),t=i.text(),n<0&&(t="-"+t),t}function showProductImage(n,t){var u=$("<img />").attr("src",n),f=$("<div />").addClass("img-panel-header"),i=$("<div />").addClass("img-panel-content"),r;i.append(u);r=$("<div />").addClass("img-panel").append(f,i);showPanel(r,!1,!0,t)}function setupUser(){var i=$(".user"),n=$.cookie("un"),t=$.cookie("pw");n&&t&&login(n,t).done(function(n){user=n;setupUserIcon()});i.click(function(){if(user)user=undefined,$.removeCookie("un",{path:"/"}),$.removeCookie("pw",{path:"/"}),setupUserIcon();else{var t=$("#login-panel").clone(!0),n=createPanel(t,!0,"ورود به سایت","dkb-customer"),i=new showPanel(n,!0,!1);n.find(".apply").click(function(){var t;if(n.find(".result").hide(),t=n.find("form"),!t.is(":valid")){n.find(".error-msg").text("لطفا شماره همراه معتبر و کلمه عبور را وارد کنید").show();return}var r=n.find('input[type="text"]').val(),u=n.find('input[type="password"]').val(),f=n.find('input[type="checkbox"]').is(":checked");login(r,u).done(function(n){f&&($.cookie("un",r,{expires:30,path:"/"}),$.cookie("pw",u,{expires:30,path:"/"}));user=n;setupUserIcon()}).fail(shopError).always(function(){i.close()})});t.show()}})}function login(n,t){var i=$.Deferred(),r={userName:n,password:t};return $.ajax({type:"POST",url:authApi,data:JSON.stringify(r),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){i.resolve(n)}).fail(function(n,t,i){var r=ajaxError(n,t,i);showPanel(r,!0,!1)}),i.promise()}function setupUserIcon(){var n=$(".user"),t,i;if(user){t=usersPath+"_"+user.id+".jpg";n.children("p").text(user.name);i=$("<img />");i.on("load",function(){n.children("span").hide();n.children("img").attr("src",t).show()});i.attr("src",t)}else n.children("p").text("ورود/ثبت نام"),n.children("span").show(),n.children("img").hide()}function setupFilterPanel(){var n=$(".filter-panel"),i=$("body");n.children(".close").click(function(){n.hasClass("show")?(n.toggleClass("show hide"),window.setTimeout(function(){n.removeClass("hide")},500),i.css("overflow","")):(n.addClass("show"),i.css("overflow","hidden"))});$("#filter-apply").click(function(n){var t,i,u,r;n.preventDefault();t=$(this).parents("form").eq(0);i=$("input.attribute:checked").map(function(){return this.value}).get().join();i!==""&&(u=$("<input />").attr({type:"hidden",value:i,name:"attributes"}),t.append(u));r=t.find("[name]").filter(function(){if(this.type==="checkbox")return this.checked;return this.value!==undefined&&this.value!==null&&this.value!==""&&!this.value.startsWith("NaN")}).serialize({checkboxesAsBools:!0});r!==""&&(window.location.search=r)});$("#filter-reset").click(function(n){n.preventDefault();window.location.search&&(window.location="/")});$(".slider-input").jRange({format:rangeCallback,width:"100%",theme:"theme-blue",showLabels:!0,isRange:!0});var t=n.find(".more"),r=t.children().first(),u=r.next();t.click(function(){t.next().slideToggle();r.toggle();u.toggle()}).click()}function rangeCallback(n,t){return n?t==="low"?"از: "+n:"تا: "+n:""}function setupPictureSize(){$(".picture-size .picture-size-btn").click(function(){var i=$(this),n,t;i.hasClass("active")||(n=this.dataset.size,i.parent().children().removeClass("active"),i.addClass("active"),$(".products .product .image").each(function(t,i){var r=$(i),f=r.parent(),o=f.attr("data-id"),e,u;r.html("");r.css("background-image","url('/img/product-loading.gif')");e=productsPath+o+"/"+n+".jpg";u=document.createElement("img");u.src=e;u.onload=function(){r.append(u);r.css("background-image","")};u.onerror=function(){r.css("background-image","url('/img/product.png')")};f.removeClass("p160 p200 p240 p300").addClass("p"+n)}),t=new Date,t.setMonth(t.getMonth()+1),document.cookie="picture-size="+n+"; expires="+t.toUTCString(),$("html, body").stop().animate({scrollTop:0},500,"swing"))})}function checkPicturesLoaded(){window.setTimeout(function(){$(".product .image img").each(function(n,t){if(t.naturalWidth===0){var i=$(t),r=i.parent();r.addClass("no-pic").attr("href","");i.hide()}})},2e3)}function setupCategories(){$.getJSON(productApi+"categories").done(function(n){var t=$("#categoryId"),u=t.attr("data-value"),i=$("#galleryId"),f=i.attr("data-value"),e,r,o;for(e in n)r=n[e],o=$("<option />").val(r.Id).text(r.Name).data("category",r),t.append(o);t.change(function(){var n,u,r,f;if(i.html(""),i.append($("<option />").val("").text("انتخاب گالری")),n=t.children(":selected"),n.val()){galleries=n.data("category").Galleries;for(u in galleries)r=galleries[u],f=$("<option />").val(r.Id).text(r.Name),i.append(f)}});u&&(t.val(u),t.change());f&&i.val(f)})}function setupSelectControls(){var n=$(".select-control"),t=n.eq(0),i=t.attr("name"),r=n.eq(1),u=r.attr("name");n.change(function(){var n="",f=t.val(),e=r.val();f&&(n="?"+i+"="+f,e&&this.name!==i&&(n+="&"+u+"="+e));window.location.search=n})}function setupImage(){var n=$(".filter-panel");$(".product-list-item .image").click(function(){n.hide();showProductImage(this.dataset.href,function(){n.show()})})}function setupRateing(){var n=$(".rateit");n.rateit();n.bind("rated",function(){var t=+this.dataset.productId,i=$(this).rateit("value"),r=JSON.stringify({productId:t,rate:i});$.ajax({type:"POST",url:productApi+"rate",data:r,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(t){var i=Math.round(t.rate*100)/100;n.rateit("value",i);n.next().text(i+" ("+t.votes+" رای)");n.rateit("readonly",!0)}).fail(function(n,t,i){var r=ajaxError(n,t,i);showPanel(r,!0,!1)})})}function setupIcons(){$("[data-desc]").click(function(){var n=this.dataset.desc,t=createPanel(n,!1,"","",480);showPanel(t,!1,!0)})}function setupMaterialsChart(){$(".skin-materials").click(function(){var t=this.dataset.id,r=this.dataset.ties,n=new showPanel(getLoading(),!1,!1);$.get(productApi+"productcolorgroups/"+t).done(function(t){var s=$("<table />").attr({cellpadding:"0",cellspacing:"0",border:"1","class":"table-list"}),e,h,o,c,l,f,a,u,v,y;s.append("<tr><th>نام جنس<\/th><th>تعداد رنگ<\/th><th>درصد مصرف<\/th><\/tr>");e=$("<div />").addClass("chart-panel");h=$("<canvas />").attr({width:"300px",height:"300px"});e.append(h);o=[{color:"#F7464A",highlight:"#FF5A5E"},{color:"#46BFBD",highlight:"#5AD3D1"},{color:"#FDB45C",highlight:"#FFC870"}];c=[];for(i in t)colorGroup=t[i],l=Math.round(colorGroup.tiesCount/r*1e4)/100,f=$("<tr />").css("background-color",o[i].color),f.append($("<td />").text(colorGroup.materialName)),f.append($("<td />").attr("align","center").text(colorGroup.colorsCount)),f.append($("<td />").attr("align","center").text("%"+l)),s.append(f),a=colorGroup.materialName+" - "+colorGroup.colorsCount+" رنگ",u={},u.value=l,u.color=o[i].color,u.highlight=o[i].highlight,u.label=a,c.push(u);v=h.get(0).getContext("2d");new Chart(v).Pie(c);e.append(s);y=createPanel(e,!0,"جدول و نمودار توزیع جنس","dkb-chart-pie");n.setContent(y);n.setClosable(!0,!1)}).fail(function(t,i,r){n.setContent(ajaxError(t,i,r));n.setClosable(!0,!1)})});$(".bulk-materials").click(function(){var t=this.dataset.id,n=new showPanel(getLoading(),!1,!1);$.get(productApi+"productcolors/"+t).done(function(t){var f=$("<table />").attr({cellpadding:"0",cellspacing:"0",border:"1","class":"table-list"}),e,o;f.append("<tr><th>شماره<\/th><th>رنگ<\/th><th>شماره در پالت<\/th><th>وزن دقیق<\/th><th>وزن بسته<\/th><th>جنس<\/th><th>قیمت<\/th><\/tr>");for(e in t){var u=t[e],r=$("<tr />"),i=$("<td />").attr("align","center").text(eval(e)+1);r.append(i);i=$("<td />").css("background-color",u.color);r.append(i);i=$("<td />").attr("align","center").text(u.position);r.append(i);i=$("<td />").attr("align","center").text(u.weight);r.append(i);i=$("<td />").attr("align","center").text(u.bulkWeight);r.append(i);i=$("<td />").text(u.material);r.append(i);i=$("<td />").attr("align","left").text(formatCurrency(u.price));r.append(i);f.append(r)}o=createPanel(f,!0,"پالت رنگ و جنس محصول","dkb-view-list");n.setContent(o);n.setClosable(!0,!1)}).fail(function(t,i,r){n.setContent(ajaxError(t,i,r));n.setClosable(!0,!1)})})}function setupDownloadPlan(){var n=["","numerical-plan-panel","cross-plan-panel","audio-plan-panel"];$(".plan-download-btn").click(function(){var r=this.dataset.planTypeId,u=this.dataset.planId,f=n[r],i=$("#"+f).clone(!0),t=createPanel(i,!0,"دانلود نقشه","dkb-download"),e=new showPanel(t,!0,!1);i.show();t.find('input[name="planId"]').val(u);t.find("button").click(function(){e.close()})});$('#audio-plan-panel input[name="joola"]').change(function(){$(this).parents("form").children(".serial").slideToggle()})}function setupPictureSlideshow(){$(".image[data-slides]").click(function(){var t=this.dataset.slides.split(","),i=this.dataset.path,f=$("<div />").addClass("slide-panel"),e=$("<div />").addClass("slide-image"),o=$("<img />").attr({src:i+t[0]}),n,r,u,s;e.append(o);n=$("<div />").addClass("slide-thumbs");for(r in t)u=$("<img />").attr("src",i+"_"+t[r]),u.click({index:r},function(r){n.children().removeClass("selected");$(this).addClass("selected");o.attr({src:i+t[r.data.index]})}),n.append(u);f.append(e,n);n.children().first().addClass("selected");s=createPanel(f,!0);showPanel(s,!0,!1)})}function setupShopping(){$(".shop-btn").click(function(){var t=+this.dataset.id,i=this.dataset.entity,r=$.cookie("un"),u=$.cookie("pw"),e;if(!r||!u){var f=$("#login-panel").clone(!0),n=createPanel(f,!0,"ورود به سایت","dkb-customer"),o=new showPanel(n,!0,!1);n.find(".apply").click(function(){var r;if(n.find(".result").hide(),r=n.find("form"),!r.is(":valid")){n.find(".error-msg").text("لطفا شماره همراه معتبر و کلمه عبور را وارد کنید").show();return}var u=n.find('input[type="text"]').val(),f=n.find('input[type="password"]').val(),e=n.find('input[type="checkbox"]').is(":checked"),s=JSON.stringify({id:t,entity:i,cell:u,password:f});sendShopData(s).done(function(){e&&($.cookie("un",u,{expires:30,path:"/"}),$.cookie("pw",f,{expires:30,path:"/"}));shopSuccess()}).fail(shopError).always(function(){o.close()})});f.show();return}e=JSON.stringify({id:t,entity:i,cell:r,password:u});sendShopData(e).done(shopSuccess).fail(shopError)})}function shopSuccess(){var r=$("<p />").html("محصول مورد نظر شما با موفقیت به سبد خرید اضافه شد."),n=$("<div />"),t=$("<div />"),u=$("<a />").attr({href:shopUrl+"/basket",target:"_blank"}).text("مشاهده سبد خرید در فروشگاه آنلاین"),f=$("<p />").addClass("btn").text("ادامه خرید و مشاهده سایر محصولات"),i;t.append(u,f);n.append(r,t);i=createPanel(n,!1,null,null,320);new showPanel(i,!1,!0)}function shopError(n){var r=$("<span />").addClass("dkb-triangle-danger"),t=$("<div />").addClass("error-panel-rtl"),i;t.append(r);t.append($("<h1 />").text("خطا"));t.append($("<p />").html(n));i=createPanel(t,!0,"خطا هنگام ثبت محصول در سبد خرید","dkb-triangle-danger","80%");new showPanel(i,!1,!0)}function sendShopData(n){var t=$.Deferred();return $.ajax({type:"POST",url:productApi+"addToBasket",data:n,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){n.result?t.reject(n.result):t.resolve()}).fail(function(n,t,i){var r=ajaxError(n,t,i);showPanel(r,!0,!1)}),t.promise()}function setupBulkTypes(){$(".bulk-type-title").click(function(){var n=$(this),t=n.parent(),i=t.hasClass("open");$(".bulk-type-group.open").each(function(n,t){var i=$(t);i.removeClass("open");i.children().eq(1).slideUp()});i||(t.addClass("open"),n.next().slideToggle())})}function setupMainImage(){$(".product-body .image").click(function(){showProductImage(this.dataset.href)})}$(document).ready(function(){setupMenu();setupMobileMenu();setupLinkPanel();setupUser()});var user,productApi="/api/products/",authApi="/api/auth/";(function(n){n.fn.serialize=function(t){return n.param(this.serializeArray(t))};n.fn.serializeArray=function(t){var i=n.extend({checkboxesAsBools:!1},t||{}),r=/select|textarea/i,u=/text|hidden|password|search|number/i;return this.map(function(){return this.elements?n.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||i.checkboxesAsBools&&this.type==="checkbox"||r.test(this.nodeName)||u.test(this.type))}).map(function(t,r){var u=n(this).val();return u===null?null:n.isArray(u)?n.map(u,function(n){return{name:r.name,value:n}}):{name:r.name,value:i.checkboxesAsBools&&this.type==="checkbox"?this.checked?!0:!1:u}}).get()}})(jQuery);$(document).ready(function(){setupFilterPanel();setupPictureSize();checkPicturesLoaded();setupCategories();setupSelectControls();setupImage()});$(document).ready(function(){setupRateing();setupIcons();setupMaterialsChart();setupDownloadPlan();setupPictureSlideshow();setupShopping();setupBulkTypes();setupMainImage()});